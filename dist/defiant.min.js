/* Javascript by Hakan Bilgin (c) 2013-2014 */(function(window,document,undefined){"use strict";var Defiant={is_safari:null!==navigator.userAgent.match(/safari/i),xml_decl:'<?xml version="1.0" encoding="utf-8"?>',render:function(e,t){var n,r,o=new XSLTProcessor,i=document.createElement("span"),l={match:"/"};switch(typeof e){case"object":this.extend(l,e),l.data||(l.data=t);break;case"string":l.template=e,l.data=t;break;default:throw"error"}if(l.data=JSON.toXML(l.data),this.xsl_template||this.gather_templates(),r=this.xsl_template.selectSingleNode('//xsl:template[@name="'+l.template+'"]'),r.setAttribute("match",l.match),o.importStylesheet(this.xsl_template),i.appendChild(o.transformToFragment(l.data,document)),r.removeAttribute("match"),this.is_safari){n=i.getElementsByTagName("script");for(var s=0,a=n.length;a>s;s++)n[s].defer=!0}return i.innerHTML},gather_templates:function(){for(var e=document.getElementsByTagName("script"),t="defiant/xsl-template",n="",r=0,o=e.length;o>r;r++)e[r].type===t&&(n+=e[r].innerHTML);this.xsl_template=this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:defiant="defiant-custom-namespace">'+n.replace(/defiant:(\w+)/g,"$1")+"</xsl:stylesheet>")},xmlFromString:function(e){var t,n;return e=e.replace(/> {1,}</g,"><"),null===e.match(/<\?xml/)&&(e=this.xml_decl+e),window.DOMParser?(t=new DOMParser,n=t.parseFromString(e,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(e)),n},extend:function(e,t){for(var n in t)e[n]&&"object"==typeof t[n]?this.extend(e[n],t[n]):e[n]=t[n];return e}};String.prototype.fill||(String.prototype.fill=function(e,t){var n=this;for(t=t||" ";e>n.length;n+=t);return n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")}),Document.selectNodes||(Document.prototype.selectNodes=function(e,t){t||(t=this),this.ns=this.createNSResolver(this.documentElement),this.qI=this.evaluate(e,t,this.ns,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var n=[],r=0;this.qI.snapshotLength>r;r++)n[r]=this.qI.snapshotItem(r);return n}),Document.selectSingleNode||(Document.prototype.selectSingleNode=function(e,t){return t||(t=this),this.xI=this.selectNodes(e,t),this.xI.length>0?this.xI[0]:null}),Node.selectNodes||(Node.prototype.selectNodes=function(e){return this.ownerDocument.selectNodes(e,this)}),Node.selectSingleNode||(Node.prototype.selectSingleNode=function(e){return this.ownerDocument.selectSingleNode(e,this)}),Node.xml||Node.prototype.__defineGetter__("xml",function(){for(var e,t,n=new XMLSerializer,r=n.serializeToString(this).replace(/(>)\s*(<)(\/*)/g,"$1\n$2$3"),o=r.split("\n"),i=-1,l="",s=0,a=o.length;a>s;s++)o[s].toLowerCase()!==Defiant.xml_decl.toLowerCase()&&(e=null!==o[s].match(/<[^\/]+>/g),t=null!==o[s].match(/<\/\w+>/g),null!==o[s].match(/<.*?\/>/g)&&(e=t=!0),e&&i++,o[s]=l.fill(i,"	")+o[s],e&&t&&i--,!e&&t&&i--);return o.join("\n").replace(/\t/g,l.fill(4," "))}),Node.text||(Node.prototype.__defineGetter__("text",function(){return this.textContent}),Node.prototype.__defineSetter__("text",function(e){this.textContent=e})),Node.toJSON||(Node.prototype.toJSON=function(e){var t=function(e){var n,r,o={};if("string"==typeof e&&(e=Defiant.xmlFromString(e)),1==e.nodeType){if(n=e.attributes,n.length>0)for(var i,l=0,s=n.length;s>l;l++)i=n.item(l),r=i.nodeValue,o["@"+i.nodeName]=r==+r?+r:r}else 3==e.nodeType&&(r=e.nodeValue,o=r==+r?+r:r);if(e.hasChildNodes())for(var a=0,c=e.childNodes.length;c>a;a++){var u=e.childNodes.item(a),h=u.nodeName;if(u.childNodes,o[h]===undefined){if("#text"===h){if(r=u.nodeValue,"{}"===JSON.stringify(o))return r==+r?+r:r;o[h]=r}o[h]=t(u)}else{if(o[h].push===undefined){var d=o[h];o[h]=[],o[h].push(d)}o[h].push(t(u))}}return o},n=t(this);return e?JSON.stringify(n,null,"	"):n}),window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(e){if(e instanceof Object){var t="";if(e.constructor===Array){for(var n=0;e.length>n;t+=this.stringify(e[n])+",",n++);return"["+t.substr(0,t.length-1)+"]"}if(e.toString!==Object.prototype.toString)return'"'+(""+e).replace(/"/g,"\\$&")+'"';for(var r in e)t+='"'+r.replace(/"/g,"\\$&")+'":'+this.stringify(e[r])+",";return"{"+t.substr(0,t.length-1)+"}"}return"string"==typeof e?'"'+e.replace(/"/g,"\\$&")+'"':e+""}}),JSON.toXML||(JSON.toXML=function(e){var t={repl:function(e){for(var t in this)delete this[t];Defiant.extend(this,e)},to_xml:function(e){var t=this.hash_to_xml(null,e).replace(/<\d{1,}>|<\/\d{1,}>/g,"");return Defiant.xmlFromString(t)},hash_to_xml:function(e,t,n){var r=[],o=[];for(var i in t){var l=t[i],s=typeof l,a=n?e:i,c="@"===a.slice(0,1);switch(c&&(a=a.slice(1)),!0){case l===undefined||null==l:r.push("<"+a+" />");break;case"object"===s:r.push(this.hash_to_xml(a,l,l.constructor==Array));break;default:c?o.push(a+'="'+l+'"'):r.push(this.scalar_to_xml(a,l))}}return e||(e="data"),n?r.join(""):"<"+e+(o.length?" "+o.join(" "):"")+(r.length?">"+r.join("")+"</"+e+">":"/>")},scalar_to_xml:function(e,t){return"#text"===e?this.escape_xml(t):"<"+e+">"+this.escape_xml(t)+"</"+e+">"},escape_xml:function(e){return(e+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},n=t.to_xml.call(t,e);return t.repl.call(e,n.documentElement.toJSON()),n}),JSON.search||(JSON.search=function(e,t,n){if(e.constructor!==Object)throw"object is not valid JSON";var r,o,i,l,s,a,c,u,h,d=null===n?[]:!1,f=JSON.toXML(e),m=f[n?"selectSingleNode":"selectNodes"](t),p=[];n&&(m=[m]);for(var g=0,N=m.length;N>g;g++)if(r=[],o=m[g],o!==o.ownerDocument.documentElement){for(i=0;o=o.previousSibling;)i++;for(o=m[g];o!==f.documentElement;)r.push({node:o,key:o.nodeName,val:2===o.nodeType?o.value:o.toJSON(!0),index:i}),o=2===o.nodeType?o.ownerElement:o.parentNode;p.push(r.reverse())}for(g=0,N=p.length;N>g;g++){for(h=e,l=0,a=0,s=0;p[g].length>l;){if(u=p[g][l],h=h[u.key],d&&p[g].length-1>l){var x=u.val.replace(/\t/g,""),v=p[g][l+1].val.replace(/\t/g,""),S=x.indexOf(v);s+=S}if("object"==typeof h&&h.constructor==Array)for(var y=u.index,_=h.length;_>y;y++)if(u.val===JSON.stringify(h[y],null,"	")){h=h[y];break}l++}switch(d&&(a=s?p[g][0].val.replace(/\t/g,"").slice(0,s).match(/\n/g).length:0,c=u.val.match(/\n/g),d.push([a+2,null===c?0:c.length])),u.node.nodeType){case 2:p[g]=u.node.value;break;case 3:p[g]=u.node.text;break;default:p[g]=h||u.val}}return d?this.trace=d:delete this.trace,p}),window.Defiant=Defiant})(window,document),"undefined"!=typeof jQuery&&function(e){e.fn.defiant=function(e,t){return this.html(Defiant.render(e,t)),this}}(jQuery);