/* Javascript by Hakan Bilgin (c) 2013-2014 */(function(window,document,undefined){"use strict";var Defiant={is_safari:null!==navigator.userAgent.match(/safari/i),namespace:'xmlns:defiant="defiant-custom-namespace"',xml_decl:'<?xml version="1.0" encoding="utf-8"?>',render:function(e,t){var n,r,i=new XSLTProcessor,o=document.createElement("span"),a={match:"/"};switch(typeof e){case"object":this.extend(a,e),a.data||(a.data=t);break;case"string":a.template=e,a.data=t;break;default:throw"error"}if(a.data=JSON.toXML(a.data),this.xsl_template||this.gather_templates(),r=this.xsl_template.selectSingleNode('//xsl:template[@name="'+a.template+'"]'),r.setAttribute("match",a.match),i.importStylesheet(this.xsl_template),o.appendChild(i.transformToFragment(a.data,document)),r.removeAttribute("match"),this.is_safari){n=o.getElementsByTagName("script");for(var s=0,l=n.length;l>s;s++)n[s].defer=!0}return o.innerHTML},gather_templates:function(){for(var e=document.getElementsByTagName("script"),t="defiant/xsl-template",n="",r=0,i=e.length;i>r;r++)e[r].type===t&&(n+=e[r].innerHTML);this.xsl_template=this.xmlFromString('<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" '+this.namespace+">"+n.replace(/defiant:(\w+)/g,"$1")+"</xsl:stylesheet>")},xmlFromString:function(e){var t,n;return e=e.replace(/> {1,}</g,"><"),null===e.match(/<\?xml/)&&(e=this.xml_decl+e),window.DOMParser?(t=new DOMParser,n=t.parseFromString(e,"text/xml")):(n=new ActiveXObject("Microsoft.XMLDOM"),n.async="false",n.loadXML(e)),n},extend:function(e,t){for(var n in t)e[n]&&"object"==typeof t[n]?this.extend(e[n],t[n]):e[n]=t[n];return e}};String.prototype.fill||(String.prototype.fill=function(e,t){var n=this;for(t=t||" ";e>n.length;n+=t);return n}),String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/gm,"")}),Document.selectNodes||(Document.prototype.selectNodes=function(e,t){t||(t=this),this.ns=this.createNSResolver(this.documentElement),this.qI=this.evaluate(e,t,this.ns,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);for(var n=[],r=0;this.qI.snapshotLength>r;r++)n[r]=this.qI.snapshotItem(r);return n}),Document.selectSingleNode||(Document.prototype.selectSingleNode=function(e,t){return t||(t=this),this.xI=this.selectNodes(e,t),this.xI.length>0?this.xI[0]:null}),Node.selectNodes||(Node.prototype.selectNodes=function(e){return this.ownerDocument.selectNodes(e,this)}),Node.selectSingleNode||(Node.prototype.selectSingleNode=function(e){return this.ownerDocument.selectSingleNode(e,this)}),Node.xml||Node.prototype.__defineGetter__("xml",function(){for(var e,t,n=new XMLSerializer,r=n.serializeToString(this).replace(/(>)\s*(<)(\/*)/g,"$1\n$2$3"),i=r.split("\n"),o=-1,a="",s=0,l=i.length;l>s;s++)i[s].toLowerCase()!==Defiant.xml_decl.toLowerCase()&&(e=null!==i[s].match(/<[^\/]+>/g),t=null!==i[s].match(/<\/\w+>/g),null!==i[s].match(/<.*?\/>/g)&&(e=t=!0),e&&o++,i[s]=a.fill(o,"	")+i[s],e&&t&&o--,!e&&t&&o--);return i.join("\n").replace(/\t/g,a.fill(4," "))}),Node.text||(Node.prototype.__defineGetter__("text",function(){return this.textContent}),Node.prototype.__defineSetter__("text",function(e){this.textContent=e})),Node.toJSON||(Node.prototype.toJSON=function(e){var t=function(e){var n,r,i,o={};switch(e.getAttribute&&"array"===e.getAttribute("defiant:type")&&(o=[],e.removeAttribute("type")),"string"==typeof e&&(e=Defiant.xmlFromString(e)),e.nodeType){case 1:if(n=e.attributes,n.length>0)for(var a,s=0,l=n.length;l>s;s++)a=n.item(s),r=a.nodeValue,o["@"+a.nodeName]=r==+r?+r:r;break;case 3:r=e.nodeValue,o=r==+r?+r:r}if(e.hasChildNodes()){i=o.constructor===Array;for(var c=0,u=e.childNodes.length;u>c;c++){var h=e.childNodes.item(c),f=h.nodeName;if(h.childNodes,o[f]===undefined){if("#text"===f){if(r=h.nodeValue,"{}"===JSON.stringify(o))return r==+r?+r:r;o[f]=r}i?o.push(t(h)):o[f]=t(h)}else{if(o[f].push===undefined){var d=o[f];o[f]=[],o[f].push(d)}o[f].push(t(h))}}}else o=null;return o},n=9===this.nodeType?this.documentElement:this,r=t(n);return e?JSON.stringify(r,null,"	"):r}),window.JSON||(window.JSON={parse:function(sJSON){return eval("("+sJSON+")")},stringify:function(e){if(e instanceof Object){var t="";if(e.constructor===Array){for(var n=0;e.length>n;t+=this.stringify(e[n])+",",n++);return"["+t.substr(0,t.length-1)+"]"}if(e.toString!==Object.prototype.toString)return'"'+(""+e).replace(/"/g,"\\$&")+'"';for(var r in e)t+='"'+r.replace(/"/g,"\\$&")+'":'+this.stringify(e[r])+",";return"{"+t.substr(0,t.length-1)+"}"}return"string"==typeof e?'"'+e.replace(/"/g,"\\$&")+'"':e+""}}),JSON.toXML||(JSON.toXML=function(e){var t,n={array_flag:'defiant:type="array"',repl:function(e){for(var t in this)delete this[t];Defiant.extend(this,e)},to_xml:function(e){var t=this.hash_to_xml(null,e).replace(/<\d{1,}>|<\/\d{1,}>/g,"");return Defiant.xmlFromString(t)},hash_to_xml:function(e,n,r){var i,o,a,s,l,c,u,h=[],f=[],d=n.constructor===Array;for(l in n)switch(c=n[l],s=typeof c,u=r?e:l,o="@"===u.slice(0,1),o&&(u=u.slice(1)),!0){case c===undefined||null==c:h.push("<"+(d?"i":u)+" />");break;case"object"===s:i=c.constructor===Array,a=this.hash_to_xml(u,c,i),d&&(t=!0,a="<i "+(i?this.array_flag:"")+">"+a+"</i>"),h.push(a);break;default:o?f.push(u+'="'+this.escape_xml(c)+'"'):h.push(this.scalar_to_xml(u,c,d))}return e||(e="data",(t||d)&&f.push(Defiant.namespace)),d&&f.push(this.array_flag),r?h.join(""):"<"+e+(f.length?" "+f.join(" "):"")+(h.length?">"+h.join("")+"</"+e+">":"/>")},scalar_to_xml:function(e,t,n){return n&&(e="i"),"#text"===e?this.escape_xml(t):"<"+e+">"+this.escape_xml(t)+"</"+e+">"},escape_xml:function(e){return(e+"").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},r=n.to_xml.call(n,e);return n.repl.call(e,r.documentElement.toJSON()),r}),JSON.search||(JSON.search=function(e,t,n){var r,i,o,a,s,l,c,u,h,f=null===n?[]:!1,d=JSON.toXML(e),p=d[n?"selectSingleNode":"selectNodes"](t),m=[];n&&(p=[p]);for(var g=0,y=p.length;y>g;g++)if(r=[],i=p[g],i!==i.ownerDocument.documentElement){for(o=0;i=i.previousSibling;)o++;for(i=p[g];i!==d.documentElement;)r.push({node:i,key:i.nodeName,val:2===i.nodeType?i.value:i.toJSON(!0),index:o}),i=2===i.nodeType?i.ownerElement:i.parentNode;m.push(r.reverse())}for(g=0,y=m.length;y>g;g++){for(h=e,a=0,l=0,s=0;m[g].length>a;){if(u=m[g][a],h=h[u.key],f&&m[g].length-1>a){var N=u.val.replace(/\t/g,""),x=m[g][a+1].val.replace(/\t/g,""),v=N.indexOf(x);s+=v}if("object"==typeof h&&h.constructor==Array)for(var S=u.index,_=h.length;_>S;S++)if(u.val===JSON.stringify(h[S],null,"	")){h=h[S];break}a++}switch(f&&(l=s?m[g][0].val.replace(/\t/g,"").slice(0,s).match(/\n/g).length:0,c=u.val.match(/\n/g),f.push([l+2,null===c?0:c.length])),u.node.nodeType){case 2:m[g]=u.node.value;break;case 3:m[g]=u.node.text;break;default:m[g]=h||u.val}}return f?this.trace=f:delete this.trace,m}),window.Defiant=Defiant})(window,document),"undefined"!=typeof jQuery&&function(e){e.fn.defiant=function(e,t){return this.html(Defiant.render(e,t)),this}}(jQuery);